name: deploy

on:
  push:
    branches: 
      - main

jobs:
  pylint:  # Reuse your existing pylint job configuration here
    runs-on: ubuntu-latest
    strategy:
      matrix:
        python-version: ["3.12"]
    steps:
    - uses: actions/checkout@v3
    - name: Set up Python ${{ matrix.python-version }}
      uses: actions/setup-python@v5
      with:
        python-version: ${{ matrix.python-version }}
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install pylint
        pip install -r requirements.txt
    - name: Analysing the code with pylint
      run: |
        pylint $(git ls-files '*.py') --errors-only
  deploy:  # Deployment job depends on pylint succeeding
    runs-on: ubuntu-latest
    needs: [ pylint ]  # Needs the "pylint" job to succeed before running
    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-python@v5
        with:
          python-version: '3.x' 
      - run: |
          echo $HEROKU_API_KEY | base64 --decode -w0 > ~/.netrc
          heroku git:remote -a take-a-hike
          git push heroku main 
        env:
          HEROKU_API_KEY: ${{ secrets.HEROKU_API_KEY }}
    environment: staging

        